---
title: "Study 4: Extroversion Data Analysis"
subtitle: "Full Model Prior-Posterior Sensitivity Part 1"
author: "R. Noah Padgett"
date: "2022-01-17"
output: html_document
---

```{r set-up, message=FALSE, error=FALSE, warning=FALSE}

# Load packages & utility functions
source("code/load_packages.R")
source("code/load_utility_functions.R")
# environment options
options(scipen = 999, digits=3)

library(diffIRT)
data("extraversion")
mydata <- na.omit(extraversion)

# model constants
# Save parameters
jags.params <- c("tau",
                 "lambda","lambda.std",
                 "theta",
                 "icept",
                 "prec",
                 "prec.s",
                 "sigma.ts",
                 "rho",
                 "reli.omega")
#data
jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2
)


NBURN = 5000
NITER = 10000

```


# Model 4: Full IFA with Misclassification

The code below contains the specification of the full model that has been used throughout this project.

```{r model4-code, cache=TRUE, autodep=TRUE}

cat(read_file(paste0(w.d, "/code/study_4/model_4.txt")))

# omega simulator
prior_omega <- function(lambda, theta){
  (sum(lambda)**2)/(sum(lambda)**2 + sum(theta))
}

# induced prior on omega is:
prior_lambda <- function(n){
  y <- rep(-1, n)
  for(i in 1:n){
    while(y[i] < 0){
      y[i] <- rnorm(1, 0, sqrt(1/.44))
    }
  }
  return(y)
}

nsim=1000
sim_omega <- numeric(nsim)
for(i in 1:nsim){
  lam_vec <- prior_lambda(10)
  tht_vec <- rep(1, 10)
  sim_omega[i] <- prior_omega(lam_vec, tht_vec)
}
prior_data <- data.frame(Base=sim_omega)

ggplot(prior_data, aes(x=Base))+
  geom_density(adjust=2)+
  labs(title="Induced prior on omega")+
  theme_classic()

```

I will test the various different prior structures.
The prior structure is very complex.
There are many moving pieces in this posterior distribution and for this prior-posterior sensitivity analysis we will focus on the effects of prior specification on the posterior of $\omega$ only.

The pieces are most likely to effect the posterior of $\omega$ are the priors for the

a. factor loadings ($\lambda$) 

b. misclassification rates ($\gamma$) by tuning of misclassification

For each specification below, we will show the induced prior on $\omega$.

## Factor Loading Prior Alternatives

For the following investigations, the prior for the tuning parameter of misclassification rates is held constant at 1.
The following major section will test how the tuning paramter incluences the results as well.

### Alternative A


\[\lambda \sim N^+(0,.44) \Longrightarrow \lambda \sim N^+(0,.01)\]
and remember, the variability is parameterized as the precision and not variance.

```{r model4-spec-alt-a, cache=TRUE, autodep=TRUE}

prior_lambda_A <- function(n){
  y <- rep(-1, n)
  for(i in 1:n){
    while(y[i] < 0){
      y[i] <- rnorm(1, 0, sqrt(1/.01))
    }
  }
  return(y)
}

nsim=1000
sim_omega <- numeric(nsim)
for(i in 1:nsim){
  lam_vec <- prior_lambda_A(10)
  tht_vec <- rep(1, 10)
  sim_omega[i] <- prior_omega(lam_vec, tht_vec)
}
prior_data$Alt_A <- sim_omega

ggplot(prior_data, aes(x=Alt_A))+
  geom_density(adjust=2)+
  labs(title="Induced prior on omega")+
  theme_classic()

```


### Alternative B


\[\lambda \sim N^+(0,.44) \Longrightarrow \lambda \sim N^+(0,1)\]

```{r model4-spec-alt-b, cache=TRUE, autodep=TRUE}

prior_lambda_B <- function(n){
  y <- rep(-1, n)
  for(i in 1:n){
    while(y[i] < 0){
      y[i] <- rnorm(1, 0, 1)
    }
  }
  return(y)
}

sim_omega <- numeric(nsim)
for(i in 1:nsim){
  lam_vec <- prior_lambda_B(10)
  tht_vec <- rep(1, 10)
  sim_omega[i] <- prior_omega(lam_vec, tht_vec)
}
prior_data$Alt_B <- sim_omega

ggplot(prior_data, aes(x=Alt_B))+
  geom_density(adjust=2)+
  labs(title="Induced prior on omega")+
  theme_classic()


```

### Alternative C

\[\lambda \sim N^+(0,.44) \Longrightarrow \lambda \sim N^+(0,10)\]

```{r model4-spec-alt-c, cache=TRUE, autodep=TRUE}

prior_lambda_C <- function(n){
    y <- rep(-1, n)
  for(i in 1:n){
    while(y[i] < 0){
      y[i] <- rnorm(1, 0, sqrt(1/10))
    }
  }
  return(y)
}

sim_omega <- numeric(nsim)
for(i in 1:nsim){
  lam_vec <- prior_lambda_C(10)
  tht_vec <- rep(1, 10)
  sim_omega[i] <- prior_omega(lam_vec, tht_vec)
}
prior_data$Alt_C <- sim_omega

ggplot(prior_data, aes(x=Alt_C))+
  geom_density(adjust=2)+
  labs(title="Induced prior on omega")+
  theme_classic()

```

### Alternative D


\[\lambda \sim N^+(0,.44) \Longrightarrow \lambda \sim N(0, 0.44)\]

```{r model4-spec-alt-d, cache=TRUE, autodep=TRUE}

prior_lambda_D <- function(n){
  rnorm(n, 0, sqrt(1/0.44))
}

sim_omega <- numeric(nsim)
for(i in 1:nsim){
  lam_vec <- prior_lambda_D(10)
  tht_vec <- rep(1, 10)
  sim_omega[i] <- prior_omega(lam_vec, tht_vec)
}
prior_data$Alt_D <- sim_omega

ggplot(prior_data, aes(x=Alt_D))+
  geom_density(adjust=2)+
  labs(title="Induced prior on omega")+
  theme_classic()

```



### Alternative E


\[\lambda \sim N^+(0,.44) \Longrightarrow \lambda \sim N(0,0.01)\]

```{r model4-spec-alt-e, cache=TRUE, autodep=TRUE}

prior_lambda_E <- function(n){
  rnorm(n, 0, sqrt(1/0.01))
}

sim_omega <- numeric(nsim)
for(i in 1:nsim){
  lam_vec <- prior_lambda_E(10)
  tht_vec <- rep(1, 10)
  sim_omega[i] <- prior_omega(lam_vec, tht_vec)
}
prior_data$Alt_E <- sim_omega

ggplot(prior_data, aes(x=Alt_E))+
  geom_density(adjust=2)+
  labs(title="Induced prior on omega")+
  theme_classic()

```


### Alternative F


\[\lambda \sim N^+(0,.44) \Longrightarrow \lambda \sim N(0,1)\]

```{r model4-spec-alt-f, cache=TRUE, autodep=TRUE}

prior_lambda_F <- function(n){
  rnorm(n, 0, 1)
}

sim_omega <- numeric(nsim)
for(i in 1:nsim){
  lam_vec <- prior_lambda_F(10)
  tht_vec <- rep(1, 10)
  sim_omega[i] <- prior_omega(lam_vec, tht_vec)
}
prior_data$Alt_F <- sim_omega

ggplot(prior_data, aes(x=Alt_F))+
  geom_density(adjust=2)+
  labs(title="Induced prior on omega")+
  theme_classic()

```

### Alternative G


\[\lambda \sim N^+(0,.44) \Longrightarrow \lambda \sim N(0,10)\]

```{r model4-spec-alt-g, cache=TRUE, autodep=TRUE}

prior_lambda_G <- function(n){
  rnorm(n, 0, sqrt(1/10))
}

sim_omega <- numeric(nsim)
for(i in 1:nsim){
  lam_vec <- prior_lambda_G(10)
  tht_vec <- rep(1, 10)
  sim_omega[i] <- prior_omega(lam_vec, tht_vec)
}
prior_data$Alt_G <- sim_omega

ggplot(prior_data, aes(x=Alt_G))+
  geom_density(adjust=2)+
  labs(title="Induced prior on omega")+
  theme_classic()

```


### Comparing A-E

```{r model4-spec-compare, cache=TRUE, autodep=TRUE}

# lambda
prior_dat_lambda <- data.frame(
  Base = prior_lambda(10000),
  Alt_A = prior_lambda_A(10000),
  Alt_B = prior_lambda_B(10000),
  Alt_C = prior_lambda_C(10000),
  Alt_D = prior_lambda_D(10000),
  Alt_E = prior_lambda_E(10000),
  Alt_F = prior_lambda_F(10000),
  Alt_G = prior_lambda_G(10000)
)%>%
  pivot_longer(
    cols=everything(),
    names_to="Prior",
    values_to="lambda"
  ) %>%
  mutate(
    Prior = factor(Prior, levels=c("Base", "Alt_A", "Alt_B", "Alt_C", "Alt_D", "Alt_E", "Alt_F", "Alt_G"))
  )
cols=c("Base"="black", "Alt_A"="#009e73", "Alt_B"="#E69F00", "Alt_C"="#CC79A7","Alt_D"="#56B4E9", "Alt_E"="#f0e442", "Alt_F"="#0072b2", "Alt_G"="#d55e00") #"#56B4E9", "#E69F00" "#CC79A7", "#d55e00", "#f0e442, "	#0072b2"

p1 <- ggplot(prior_dat_lambda, aes(x=lambda, color=Prior, fill=Prior))+
  geom_density(adjust=0.1, alpha=0.1, size=1)+
  scale_color_manual(values=cols, name="Prior")+
  scale_fill_manual(values=cols, name="Prior")+
  lims(x=c(-5,5))+
  theme_bw()+
  theme(
    panel.grid = element_blank()
  )
p1

plot.prior <- prior_data %>%
  pivot_longer(
    cols=everything(),
    names_to="Prior",
    values_to="omega"
  ) %>%
  mutate(
    Prior = factor(Prior, levels=c("Base", "Alt_A", "Alt_B", "Alt_C", "Alt_D", "Alt_E", "Alt_F", "Alt_G"))
  )
cols=c("Base"="black", "Alt_A"="#009e73", "Alt_B"="#E69F00", "Alt_C"="#CC79A7","Alt_D"="#56B4E9", "Alt_E"="#f0e442", "Alt_F"="#0072b2", "Alt_G"="#d55e00") #"#56B4E9", "#E69F00" "#CC79A7", "#d55e00", "#f0e442, "	#0072b2"

p2 <- ggplot(plot.prior, aes(x=omega, color=Prior, fill=Prior))+
  geom_density(adjust=2, alpha=0.1, size=1)+
  scale_color_manual(values=cols, name="Prior")+
  scale_fill_manual(values=cols, name="Prior")+
  lims(y=c(0,20))+
  theme_bw()+
  theme(
    panel.grid = element_blank()
  )
p2
  

p1 + p2 + plot_layout(guides="collect")
```


## Estimate Models

### Base Priors

For the base model, the priors are

\[\lambda \sim N^+(0,.44)\]
\[\xi = 1\]


```{r base-base, cache=TRUE, autodep=TRUE}

# Save parameters
jags.params <- c("lambda.std",
                 "reli.omega",
                 "gamma[109,1,1,1]",
                 "gamma[109,1,1,2]",
                 "gamma[109,1,2,1]",
                 "gamma[109,1,2,2]",
                 "omega[109,1,2]",
                 "pi[109,1,2]",
                 "gamma[98,1,1,1]",
                 "gamma[98,1,1,2]",
                 "gamma[98,1,2,1]",
                 "gamma[98,1,2,2]",
                 "omega[98,1,2]",
                 "pi[98,1,2]")
# initial-values
jags.inits <- function(){
    list(
      "tau"=matrix(c(-0.64, -0.09, -1.05, -1.42, -0.11, -1.29, -1.59, -1.81, -0.93, -1.11), ncol=1, nrow=10),
      "lambda"=rep(0.7,10),
      "eta"=rnorm(142),
      "speed"=rnorm(142),
      "ystar"=matrix(c(0.7*rep(rnorm(142),10)), ncol=10),
      "rho"=0.1,
      "icept"=rep(0, 10),
      "prec.s"=10,
      "prec"=rep(4, 10),
      "sigma.ts"=0.1
    )
  }
jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2,
  xi = 1
)

# Run model
fit.base_prior <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4w_xi.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)
```

### Base $\lambda$ Prior with Alt Tune A $\xi = 0.1$

\[\lambda \sim N^+(0,.44)\]
\[\xi = 0.1\]

```{r model4-base-alt-a, cache=TRUE, autodep=TRUE}

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2,
  xi = 0.1
)

# Run model
fit.base_alt_a <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4w_xi.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.base_alt_a, width=1000)

```

### Base $\lambda$ Prior with Alt Tune B $\xi = 10$

\[\lambda \sim N^+(0,.44)\]
\[\xi = 10\]

```{r model4-base-alt-b, cache=TRUE, autodep=TRUE}

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2,
  xi = 10
)

# Run model
fit.base_alt_b <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4w_xi.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.base_alt_b, width=1000)

```

### Base $\lambda$ Prior with Alt Tune C $\xi U(0.5,1.5)$

\[\lambda \sim N^+(0,.44)\]
\[\xi \sim Uniform(0.5,1.5)\]


```{r model4-base-alt-c, cache=TRUE, autodep=TRUE}

jags.params <- c("lambda.std",
                 "reli.omega",
                 "gamma[109,1,1,1]",
                 "gamma[109,1,1,2]",
                 "gamma[109,1,2,1]",
                 "gamma[109,1,2,2]",
                 "omega[109,1,2]",
                 "pi[109,1,2]",
                 "gamma[98,1,1,1]",
                 "gamma[98,1,1,2]",
                 "gamma[98,1,2,1]",
                 "gamma[98,1,2,2]",
                 "omega[98,1,2]",
                 "pi[98,1,2]",
                 "xi")

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2
)

# Run model
fit.base_alt_c <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4w_xi_uniform.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.base_alt_c, width=1000)

```



### Base $\lambda$ Prior with Alt Tune D $\xi G(1,1)$

\[\lambda \sim N^+(0,.44)\]
\[\xi \sim Gamma(1,1)\]


```{r model4-base-alt-d, cache=TRUE, autodep=TRUE}

jags.params <- c("lambda.std",
                 "reli.omega",
                 "gamma[109,1,1,1]",
                 "gamma[109,1,1,2]",
                 "gamma[109,1,2,1]",
                 "gamma[109,1,2,2]",
                 "omega[109,1,2]",
                 "pi[109,1,2]",
                 "gamma[98,1,1,1]",
                 "gamma[98,1,1,2]",
                 "gamma[98,1,2,1]",
                 "gamma[98,1,2,2]",
                 "omega[98,1,2]",
                 "pi[98,1,2]",
                 "xi")

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2
)

# Run model
fit.base_alt_d <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4w_xi_gamma.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.base_alt_d, width=1000)

```


### Alt $\lambda$ Prior A with Base Tune $\xi = 1$

\[\lambda \sim N^+(0,.01)\]
\[\xi = 1\]


```{r model4-alt-a-base, cache=TRUE, autodep=TRUE}

# Save parameters
jags.params <- c("lambda.std",
                 "reli.omega",
                 "gamma[109,1,1,1]",
                 "gamma[109,1,1,2]",
                 "gamma[109,1,2,1]",
                 "gamma[109,1,2,2]",
                 "omega[109,1,2]",
                 "pi[109,1,2]",
                 "gamma[98,1,1,1]",
                 "gamma[98,1,1,2]",
                 "gamma[98,1,2,1]",
                 "gamma[98,1,2,2]",
                 "omega[98,1,2]",
                 "pi[98,1,2]")
jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2,
  xi = 1
)

# Run model
fit.alt_a_base <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Aw_xi.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_a_base, width=1000)

```


### Alt $\lambda$ Prior A with Alt Tune A $\xi = 0.1$

\[\lambda \sim N^+(0,.01)\]
\[\xi = 0.1\]

```{r model4-alt-a-alt-a, cache=TRUE, autodep=TRUE}

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2,
  xi = 0.1
)

# Run model
fit.alt_a_alt_a <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Aw_xi.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_a_alt_a, width=1000)

```

### Alt $\lambda$ Prior A with Alt Tune B $\xi = 10$

\[\lambda \sim N^+(0,.01)\]
\[\xi = 10\]

```{r model4-alt-a-alt-b, cache=TRUE, autodep=TRUE}

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2,
  xi = 10
)

# Run model
fit.alt_a_alt_b <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Aw_xi.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_a_alt_b, width=1000)

```

### Alt $\lambda$ Prior A with Alt Tune C $\xi U(0.5,1.5)$

\[\lambda \sim N^+(0,.01)\]
\[\xi \sim Uniform(0.5,1.5)\]

```{r model4-alt-a-alt-c, cache=TRUE, autodep=TRUE}

jags.params <- c("lambda.std",
                 "reli.omega",
                 "gamma[109,1,1,1]",
                 "gamma[109,1,1,2]",
                 "gamma[109,1,2,1]",
                 "gamma[109,1,2,2]",
                 "omega[109,1,2]",
                 "pi[109,1,2]",
                 "gamma[98,1,1,1]",
                 "gamma[98,1,1,2]",
                 "gamma[98,1,2,1]",
                 "gamma[98,1,2,2]",
                 "omega[98,1,2]",
                 "pi[98,1,2]",
                 "xi")

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2
)

# Run model
fit.alt_a_alt_c <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Aw_xi_uniform.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_a_alt_c, width=1000)

```

### Alt $\lambda$ Prior A with Alt Tune D $\xi G(1,1)$

\[\lambda \sim N^+(0,.01)\]
\[\xi \sim Gamma(1,1)\]

```{r model4-alt-a-alt-d, cache=TRUE, autodep=TRUE}

jags.params <- c("lambda.std",
                 "reli.omega",
                 "gamma[109,1,1,1]",
                 "gamma[109,1,1,2]",
                 "gamma[109,1,2,1]",
                 "gamma[109,1,2,2]",
                 "omega[109,1,2]",
                 "pi[109,1,2]",
                 "gamma[98,1,1,1]",
                 "gamma[98,1,1,2]",
                 "gamma[98,1,2,1]",
                 "gamma[98,1,2,2]",
                 "omega[98,1,2]",
                 "pi[98,1,2]",
                 "xi")

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2
)

# Run model
fit.alt_a_alt_d <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Aw_xi_gamma.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_a_alt_d, width=1000)

```

### Alt $\lambda$ Prior B with Base Tune $\xi = 1$

\[\lambda \sim N^+(0,5)\]
\[\xi = 1\]


```{r model4-alt-b-base, cache=TRUE, autodep=TRUE}

# Save parameters
jags.params <- c("lambda.std",
                 "reli.omega",
                 "gamma[109,1,1,1]",
                 "gamma[109,1,1,2]",
                 "gamma[109,1,2,1]",
                 "gamma[109,1,2,2]",
                 "omega[109,1,2]",
                 "pi[109,1,2]",
                 "gamma[98,1,1,1]",
                 "gamma[98,1,1,2]",
                 "gamma[98,1,2,1]",
                 "gamma[98,1,2,2]",
                 "omega[98,1,2]",
                 "pi[98,1,2]")
jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2,
  xi = 1
)

# Run model
fit.alt_b_base <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Bw_xi.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_b_base, width=1000)

```


### Alt $\lambda$ Prior B with Alt Tune A $\xi = 0.1$

\[\lambda \sim N^+(0,5)\]
\[\xi = 0.1\]

```{r model4-alt-b-alt-a, cache=TRUE, autodep=TRUE}

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2,
  xi = 0.1
)

# Run model
fit.alt_b_alt_a <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Bw_xi.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_b_alt_a, width=1000)

```

### Alt $\lambda$ Prior B with Alt Tune B $\xi = 10$

\[\lambda \sim N^+(0,5)\]
\[\xi = 10\]

```{r model4-alt-b-alt-b, cache=TRUE, autodep=TRUE}

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2,
  xi = 10
)

# Run model
fit.alt_b_alt_b <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Bw_xi.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_b_alt_b, width=1000)

```

### Alt $\lambda$ Prior B with Alt Tune C $\xi U(0.5,1.5)$

\[\lambda \sim N^+(0,5)\]
\[\xi \sim Uniform(0.5,1.5)\]

```{r model4-alt-b-alt-c, cache=TRUE, autodep=TRUE}

jags.params <- c("lambda.std",
                 "reli.omega",
                 "gamma[109,1,1,1]",
                 "gamma[109,1,1,2]",
                 "gamma[109,1,2,1]",
                 "gamma[109,1,2,2]",
                 "omega[109,1,2]",
                 "pi[109,1,2]",
                 "gamma[98,1,1,1]",
                 "gamma[98,1,1,2]",
                 "gamma[98,1,2,1]",
                 "gamma[98,1,2,2]",
                 "omega[98,1,2]",
                 "pi[98,1,2]",
                 "xi")

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2
)

# Run model
fit.alt_b_alt_c <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Bw_xi_uniform.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_b_alt_c, width=1000)

```



### Alt $\lambda$ Prior B with Alt Tune D $\xi G(1,1)$

\[\lambda \sim N^+(0,5)\]
\[\xi \sim Gamma(1,1)\]

```{r model4-alt-b-alt-d, cache=TRUE, autodep=TRUE}

jags.params <- c("lambda.std",
                 "reli.omega",
                 "gamma[109,1,1,1]",
                 "gamma[109,1,1,2]",
                 "gamma[109,1,2,1]",
                 "gamma[109,1,2,2]",
                 "omega[109,1,2]",
                 "pi[109,1,2]",
                 "gamma[98,1,1,1]",
                 "gamma[98,1,1,2]",
                 "gamma[98,1,2,1]",
                 "gamma[98,1,2,2]",
                 "omega[98,1,2]",
                 "pi[98,1,2]",
                 "xi")

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2
)

# Run model
fit.alt_b_alt_d <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Bw_xi_gamma.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_b_alt_d, width=1000)

```



### Alt $\lambda$ Prior C with Base Tune $\xi = 1$

\[\lambda \sim N^+(0,5)\]
\[\xi = 1\]


```{r model4-alt-c-base, cache=TRUE, autodep=TRUE}

# Save parameters
jags.params <- c("lambda.std",
                 "reli.omega",
                 "gamma[109,1,1,1]",
                 "gamma[109,1,1,2]",
                 "gamma[109,1,2,1]",
                 "gamma[109,1,2,2]",
                 "omega[109,1,2]",
                 "pi[109,1,2]",
                 "gamma[98,1,1,1]",
                 "gamma[98,1,1,2]",
                 "gamma[98,1,2,1]",
                 "gamma[98,1,2,2]",
                 "omega[98,1,2]",
                 "pi[98,1,2]")
jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2,
  xi = 1
)

# Run model
fit.alt_c_base <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Cw_xi.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_c_base, width=1000)

```


### Alt $\lambda$ Prior C with Alt Tune A $\xi = 0.1$

\[\lambda \sim N(0,5)\]
\[\xi = 0.1\]

```{r model4-alt-c-alt-a, cache=TRUE, autodep=TRUE}

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2,
  xi = 0.1
)

# Run model
fit.alt_c_alt_a <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Cw_xi.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_c_alt_a, width=1000)

```

### Alt $\lambda$ Prior C with Alt Tune B $\xi = 10$

\[\lambda \sim N(0,5)\]
\[\xi = 10\]

```{r model4-alt-c-alt-b, cache=TRUE, autodep=TRUE}

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2,
  xi = 10
)

# Run model
fit.alt_c_alt_b <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Cw_xi.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_c_alt_b, width=1000)

```

### Alt $\lambda$ Prior C with Alt Tune C $\xi U(0.5,1.5)$

\[\lambda \sim N(0,5)\]
\[\xi \sim Uniform(0.5,1.5)\]

```{r model4-alt-c-alt-c, cache=TRUE, autodep=TRUE}

jags.params <- c("lambda.std",
                 "reli.omega",
                 "gamma[109,1,1,1]",
                 "gamma[109,1,1,2]",
                 "gamma[109,1,2,1]",
                 "gamma[109,1,2,2]",
                 "omega[109,1,2]",
                 "pi[109,1,2]",
                 "gamma[98,1,1,1]",
                 "gamma[98,1,1,2]",
                 "gamma[98,1,2,1]",
                 "gamma[98,1,2,2]",
                 "omega[98,1,2]",
                 "pi[98,1,2]",
                 "xi")

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2
)

# Run model
fit.alt_c_alt_c <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Cw_xi_uniform.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_c_alt_c, width=1000)

```




### Alt $\lambda$ Prior C with Alt Tune D $\xi G(1,1)$

\[\lambda \sim N(0,5)\]
\[\xi \sim Gamma(1,1)\]

```{r model4-alt-c-alt-d, cache=TRUE, autodep=TRUE}

jags.params <- c("lambda.std",
                 "reli.omega",
                 "gamma[109,1,1,1]",
                 "gamma[109,1,1,2]",
                 "gamma[109,1,2,1]",
                 "gamma[109,1,2,2]",
                 "omega[109,1,2]",
                 "pi[109,1,2]",
                 "gamma[98,1,1,1]",
                 "gamma[98,1,1,2]",
                 "gamma[98,1,2,1]",
                 "gamma[98,1,2,2]",
                 "omega[98,1,2]",
                 "pi[98,1,2]",
                 "xi")

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2
)

# Run model
fit.alt_c_alt_d <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Cw_xi_gamma.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_c_alt_d, width=1000)

```




### Alt $\lambda$ Prior D with Base Tune $\xi = 1$

\[\lambda \sim N(0,0.44)\]
\[\xi = 1\]


```{r model4-alt-d-base, cache=TRUE, autodep=TRUE}

# Save parameters
jags.params <- c("lambda.std",
                 "reli.omega",
                 "gamma[109,1,1,1]",
                 "gamma[109,1,1,2]",
                 "gamma[109,1,2,1]",
                 "gamma[109,1,2,2]",
                 "omega[109,1,2]",
                 "pi[109,1,2]",
                 "gamma[98,1,1,1]",
                 "gamma[98,1,1,2]",
                 "gamma[98,1,2,1]",
                 "gamma[98,1,2,2]",
                 "omega[98,1,2]",
                 "pi[98,1,2]")
jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2,
  xi = 1
)

# Run model
fit.alt_d_base <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Dw_xi.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_d_base, width=1000)

```


### Alt $\lambda$ Prior D with Alt Tune A $\xi = 0.1$

\[\lambda \sim N(0,0.44)\]
\[\xi = 0.1\]

```{r model4-alt-d-alt-a, cache=TRUE, autodep=TRUE}

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2,
  xi = 0.1
)

# Run model
fit.alt_d_alt_a <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Dw_xi.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_d_alt_a, width=1000)

```

### Alt $\lambda$ Prior D with Alt Tune B $\xi = 10$

\[\lambda \sim N(0,0.44)\]
\[\xi = 10\]

```{r model4-alt-d-alt-b, cache=TRUE, autodep=TRUE}

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2,
  xi = 10
)

# Run model
fit.alt_d_alt_b <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Dw_xi.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_d_alt_b, width=1000)

```

### Alt $\lambda$ Prior D with Alt Tune C $\xi U(0.5,1.5)$

\[\lambda \sim N(0,0.44)\]
\[\xi \sim Uniform(0.5,1.5)\]

```{r model4-alt-d-alt-c, cache=TRUE, autodep=TRUE}

jags.params <- c("lambda.std",
                 "reli.omega",
                 "gamma[109,1,1,1]",
                 "gamma[109,1,1,2]",
                 "gamma[109,1,2,1]",
                 "gamma[109,1,2,2]",
                 "omega[109,1,2]",
                 "pi[109,1,2]",
                 "gamma[98,1,1,1]",
                 "gamma[98,1,1,2]",
                 "gamma[98,1,2,1]",
                 "gamma[98,1,2,2]",
                 "omega[98,1,2]",
                 "pi[98,1,2]",
                 "xi")

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2
)

# Run model
fit.alt_d_alt_c <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Dw_xi_uniform.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_d_alt_c, width=1000)

```




### Alt $\lambda$ Prior D with Alt Tune D $\xi G(1,1)$

\[\lambda \sim N(0,0.44)\]
\[\xi \sim Gamma(1,1)\]

```{r model4-alt-d-alt-d, cache=TRUE, autodep=TRUE}

jags.params <- c("lambda.std",
                 "reli.omega",
                 "gamma[109,1,1,1]",
                 "gamma[109,1,1,2]",
                 "gamma[109,1,2,1]",
                 "gamma[109,1,2,2]",
                 "omega[109,1,2]",
                 "pi[109,1,2]",
                 "gamma[98,1,1,1]",
                 "gamma[98,1,1,2]",
                 "gamma[98,1,2,1]",
                 "gamma[98,1,2,2]",
                 "omega[98,1,2]",
                 "pi[98,1,2]",
                 "xi")

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2
)

# Run model
fit.alt_d_alt_d <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Dw_xi_gamma.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_d_alt_d, width=1000)

```



### Alt $\lambda$ Prior E with Base Tune $\xi = 1$

\[\lambda \sim N(0,0.01)\]
\[\xi = 1\]


```{r model4-alt-e-base, cache=TRUE, autodep=TRUE}

# Save parameters
jags.params <- c("lambda.std",
                 "reli.omega",
                 "gamma[109,1,1,1]",
                 "gamma[109,1,1,2]",
                 "gamma[109,1,2,1]",
                 "gamma[109,1,2,2]",
                 "omega[109,1,2]",
                 "pi[109,1,2]",
                 "gamma[98,1,1,1]",
                 "gamma[98,1,1,2]",
                 "gamma[98,1,2,1]",
                 "gamma[98,1,2,2]",
                 "omega[98,1,2]",
                 "pi[98,1,2]")
jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2,
  xi = 1
)

# Run model
fit.alt_e_base <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Ew_xi.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_e_base, width=1000)

```


### Alt $\lambda$ Prior E with Alt Tune A $\xi = 0.1$

\[\lambda \sim N(0,0.01)\]
\[\xi = 0.1\]

```{r model4-alt-e-alt-a, cache=TRUE, autodep=TRUE}

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2,
  xi = 0.1
)

# Run model
fit.alt_e_alt_a <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Ew_xi.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_e_alt_a, width=1000)

```

### Alt $\lambda$ Prior E with Alt Tune B $\xi = 10$

\[\lambda \sim N(0,0.01)\]
\[\xi = 10\]

```{r model4-alt-e-alt-b, cache=TRUE, autodep=TRUE}

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2,
  xi = 10
)

# Run model
fit.alt_e_alt_b <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Ew_xi.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_e_alt_b, width=1000)

```

### Alt $\lambda$ Prior E with Alt Tune C $\xi U(0.5,1.5)$

\[\lambda \sim N(0,0.01)\]
\[\xi \sim Uniform(0.5,1.5)\]

```{r model4-alt-e-alt-c, cache=TRUE, autodep=TRUE}

jags.params <- c("lambda.std",
                 "reli.omega",
                 "gamma[109,1,1,1]",
                 "gamma[109,1,1,2]",
                 "gamma[109,1,2,1]",
                 "gamma[109,1,2,2]",
                 "omega[109,1,2]",
                 "pi[109,1,2]",
                 "gamma[98,1,1,1]",
                 "gamma[98,1,1,2]",
                 "gamma[98,1,2,1]",
                 "gamma[98,1,2,2]",
                 "omega[98,1,2]",
                 "pi[98,1,2]",
                 "xi")

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2
)

# Run model
fit.alt_e_alt_c <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Ew_xi_gamma.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_e_alt_c, width=1000)

```




### Alt $\lambda$ Prior E with Alt Tune D $\xi G(1,1)$

\[\lambda \sim N(0,0.01)\]
\[\xi \sim Gamma(1,1)\]

```{r model4-alt-e-alt-d, cache=TRUE, autodep=TRUE}

jags.params <- c("lambda.std",
                 "reli.omega",
                 "gamma[109,1,1,1]",
                 "gamma[109,1,1,2]",
                 "gamma[109,1,2,1]",
                 "gamma[109,1,2,2]",
                 "omega[109,1,2]",
                 "pi[109,1,2]",
                 "gamma[98,1,1,1]",
                 "gamma[98,1,1,2]",
                 "gamma[98,1,2,1]",
                 "gamma[98,1,2,2]",
                 "omega[98,1,2]",
                 "pi[98,1,2]",
                 "xi")

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2
)

# Run model
fit.alt_e_alt_d <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Ew_xi_gamma.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_e_alt_d, width=1000)

```




### Alt $\lambda$ Prior F with Base Tune $\xi = 1$

\[\lambda \sim N(0,1)\]
\[\xi = 1\]


```{r model4-alt-f-base, cache=TRUE, autodep=TRUE}

# Save parameters
jags.params <- c("lambda.std",
                 "reli.omega",
                 "gamma[109,1,1,1]",
                 "gamma[109,1,1,2]",
                 "gamma[109,1,2,1]",
                 "gamma[109,1,2,2]",
                 "omega[109,1,2]",
                 "pi[109,1,2]",
                 "gamma[98,1,1,1]",
                 "gamma[98,1,1,2]",
                 "gamma[98,1,2,1]",
                 "gamma[98,1,2,2]",
                 "omega[98,1,2]",
                 "pi[98,1,2]")
jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2,
  xi = 1
)

# Run model
fit.alt_f_base <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Fw_xi.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_f_base, width=1000)

```


### Alt $\lambda$ Prior F with Alt Tune A $\xi = 0.1$

\[\lambda \sim N(0,1)\]
\[\xi = 0.1\]

```{r model4-alt-f-alt-a, cache=TRUE, autodep=TRUE}

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2,
  xi = 0.1
)

# Run model
fit.alt_f_alt_a <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Fw_xi.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_f_alt_a, width=1000)

```

### Alt $\lambda$ Prior F with Alt Tune B $\xi = 10$

\[\lambda \sim N(0,1)\]
\[\xi = 10\]

```{r model4-alt-f-alt-b, cache=TRUE, autodep=TRUE}

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2,
  xi = 10
)

# Run model
fit.alt_f_alt_b <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Fw_xi.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_f_alt_b, width=1000)

```

### Alt $\lambda$ Prior F with Alt Tune C $\xi U(0.5,1.5)$

\[\lambda \sim N(0,1)\]
\[\xi \sim Uniform(0.5,1.5)\]

```{r model4-alt-f-alt-c, cache=TRUE, autodep=TRUE}

jags.params <- c("lambda.std",
                 "reli.omega",
                 "gamma[109,1,1,1]",
                 "gamma[109,1,1,2]",
                 "gamma[109,1,2,1]",
                 "gamma[109,1,2,2]",
                 "omega[109,1,2]",
                 "pi[109,1,2]",
                 "gamma[98,1,1,1]",
                 "gamma[98,1,1,2]",
                 "gamma[98,1,2,1]",
                 "gamma[98,1,2,2]",
                 "omega[98,1,2]",
                 "pi[98,1,2]",
                 "xi")

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2
)

# Run model
fit.alt_f_alt_c <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Fw_xi_uniform.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_f_alt_c, width=1000)

```




### Alt $\lambda$ Prior F with Alt Tune D $\xi G(1,1)$

\[\lambda \sim N(0,1)\]
\[\xi \sim Gamma(1,1)\]

```{r model4-alt-f-alt-d, cache=TRUE, autodep=TRUE}

jags.params <- c("lambda.std",
                 "reli.omega",
                 "gamma[109,1,1,1]",
                 "gamma[109,1,1,2]",
                 "gamma[109,1,2,1]",
                 "gamma[109,1,2,2]",
                 "omega[109,1,2]",
                 "pi[109,1,2]",
                 "gamma[98,1,1,1]",
                 "gamma[98,1,1,2]",
                 "gamma[98,1,2,1]",
                 "gamma[98,1,2,2]",
                 "omega[98,1,2]",
                 "pi[98,1,2]",
                 "xi")

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2
)

# Run model
fit.alt_f_alt_d <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Fw_xi_gamma.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_f_alt_d, width=1000)

```



### Alt $\lambda$ Prior G with Base Tune $\xi = 1$

\[\lambda \sim N(0,10)\]
\[\xi = 1\]


```{r model4-alt-g-base, cache=TRUE, autodep=TRUE}

# Save parameters
jags.params <- c("lambda.std",
                 "reli.omega",
                 "gamma[109,1,1,1]",
                 "gamma[109,1,1,2]",
                 "gamma[109,1,2,1]",
                 "gamma[109,1,2,2]",
                 "omega[109,1,2]",
                 "pi[109,1,2]",
                 "gamma[98,1,1,1]",
                 "gamma[98,1,1,2]",
                 "gamma[98,1,2,1]",
                 "gamma[98,1,2,2]",
                 "omega[98,1,2]",
                 "pi[98,1,2]")
jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2,
  xi = 1
)

# Run model
fit.alt_g_base <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Gw_xi.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_g_base, width=1000)

```


### Alt $\lambda$ Prior G with Alt Tune A $\xi = 0.1$

\[\lambda \sim N(0,10)\]
\[\xi = 0.1\]

```{r model4-alt-g-alt-a, cache=TRUE, autodep=TRUE}

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2,
  xi = 0.1
)

# Run model
fit.alt_g_alt_a <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Gw_xi.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_g_alt_a, width=1000)

```

### Alt $\lambda$ Prior G with Alt Tune B $\xi = 10$

\[\lambda \sim N(0,1)\]
\[\xi = 10\]

```{r model4-alt-g-alt-b, cache=TRUE, autodep=TRUE}

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2,
  xi = 10
)

# Run model
fit.alt_g_alt_b <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Gw_xi.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_g_alt_b, width=1000)

```

### Alt $\lambda$ Prior G with Alt Tune C $\xi U(0.5,1.5)$

\[\lambda \sim N(0,10)\]
\[\xi \sim Uniform(0.5,1.5)\]

```{r model4-alt-g-alt-c, cache=TRUE, autodep=TRUE}

jags.params <- c("lambda.std",
                 "reli.omega",
                 "gamma[109,1,1,1]",
                 "gamma[109,1,1,2]",
                 "gamma[109,1,2,1]",
                 "gamma[109,1,2,2]",
                 "omega[109,1,2]",
                 "pi[109,1,2]",
                 "gamma[98,1,1,1]",
                 "gamma[98,1,1,2]",
                 "gamma[98,1,2,1]",
                 "gamma[98,1,2,2]",
                 "omega[98,1,2]",
                 "pi[98,1,2]",
                 "xi")

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2
)

# Run model
fit.alt_g_alt_c <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Gw_xi_uniform.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_g_alt_c, width=1000)

```




### Alt $\lambda$ Prior G with Alt Tune D $\xi G(1,1)$

\[\lambda \sim N(0,10)\]
\[\xi \sim Gamma(1,1)\]

```{r model4-alt-g-alt-d, cache=TRUE, autodep=TRUE}

jags.params <- c("lambda.std",
                 "reli.omega",
                 "gamma[109,1,1,1]",
                 "gamma[109,1,1,2]",
                 "gamma[109,1,2,1]",
                 "gamma[109,1,2,2]",
                 "omega[109,1,2]",
                 "pi[109,1,2]",
                 "gamma[98,1,1,1]",
                 "gamma[98,1,1,2]",
                 "gamma[98,1,2,1]",
                 "gamma[98,1,2,2]",
                 "omega[98,1,2]",
                 "pi[98,1,2]",
                 "xi")

jags.data <- list(
  y = mydata[,1:10],
  lrt = mydata[,11:20],
  N = nrow(mydata),
  nit = 10,
  ncat = 2
)

# Run model
fit.alt_g_alt_d <-  R2jags::jags(
  model = paste0(w.d, "/code/study_4/model_4Gw_xi_gamma.txt"),
  parameters.to.save = jags.params,
  inits = jags.inits,
  data = jags.data,
  n.chains = 4,
  n.burnin = NBURN,
  n.iter = NITER
)

print(fit.alt_g_alt_d, width=1000)

```




### Compare Posteriors + Priors

```{r model4-post-prior-comp, cache=TRUE, autodep=TRUE}

plot.post <- data.frame(
  Base.Base  = fit.base_prior$BUGSoutput$sims.matrix[,"reli.omega"],
  Base.Alt_A = fit.base_alt_a$BUGSoutput$sims.matrix[,"reli.omega"],
  Base.Alt_B = fit.base_alt_b$BUGSoutput$sims.matrix[,"reli.omega"],
  Base.Alt_C = fit.base_alt_c$BUGSoutput$sims.matrix[,"reli.omega"],
  Base.Alt_D = fit.base_alt_d$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_A.Base  = fit.alt_a_base$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_A.Alt_A = fit.alt_a_alt_a$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_A.Alt_B = fit.alt_a_alt_b$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_A.Alt_C = fit.alt_a_alt_c$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_A.Alt_D = fit.alt_a_alt_d$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_B.Base  = fit.alt_b_base$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_B.Alt_A = fit.alt_b_alt_a$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_B.Alt_B = fit.alt_b_alt_b$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_B.Alt_C = fit.alt_b_alt_c$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_B.Alt_D = fit.alt_b_alt_d$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_C.Base  = fit.alt_c_base$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_C.Alt_A = fit.alt_c_alt_a$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_C.Alt_B = fit.alt_c_alt_b$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_C.Alt_C = fit.alt_c_alt_c$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_C.Alt_D = fit.alt_c_alt_d$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_D.Base  = fit.alt_d_base$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_D.Alt_A = fit.alt_d_alt_a$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_D.Alt_B = fit.alt_d_alt_b$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_D.Alt_C = fit.alt_d_alt_c$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_D.Alt_D = fit.alt_d_alt_d$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_E.Base  = fit.alt_e_base$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_E.Alt_A = fit.alt_e_alt_a$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_E.Alt_B = fit.alt_e_alt_b$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_E.Alt_C = fit.alt_e_alt_c$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_E.Alt_D = fit.alt_e_alt_d$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_F.Base  = fit.alt_f_base$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_F.Alt_A = fit.alt_f_alt_a$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_F.Alt_B = fit.alt_f_alt_b$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_F.Alt_C = fit.alt_f_alt_c$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_F.Alt_D = fit.alt_f_alt_d$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_G.Base  = fit.alt_g_base$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_G.Alt_A = fit.alt_g_alt_a$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_G.Alt_B = fit.alt_g_alt_b$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_G.Alt_C = fit.alt_g_alt_c$BUGSoutput$sims.matrix[,"reli.omega"],
  Alt_G.Alt_D = fit.alt_g_alt_d$BUGSoutput$sims.matrix[,"reli.omega"]
) %>%
  pivot_longer(
    cols=everything(),
    names_to="Prior",
    values_to="omega"
  )

plot.post$lambda <- ''
plot.post$xi <- ''
i <- 1
for(i in 1:nrow(plot.post)){
  plot.post$lambda[i] = str_split(plot.post$Prior[i],"\\.", simplify = T)[1]
  plot.post$xi[i] = str_split(plot.post$Prior[i],"\\.", simplify = T)[2]
}
#cols=c("Base"="black", "Alt_A"="#009e73", "Alt_B"="#E69F00", "Alt_C"="#CC79A7","Alt_D"="#56B4E9") #"#56B4E9", "#E69F00" "#CC79A7", "#d55e00", "#f0e442, "	#0072b2"

# joint prior and post samples
plot.prior$xi="Prior"
plot.prior$type="Prior"
plot.post$type="Post"
plot.dat <- full_join(plot.prior, plot.post, by=c("Prior"="lambda", "type"="type", "omega"="omega", "xi"="xi")) %>%
  mutate(
    Prior = factor(Prior,
                   levels=c("Base", "Alt_A", "Alt_B", "Alt_C",
                            "Alt_D", "Alt_E", "Alt_F", "Alt_G"),
                   labels=c("lambda%~%{N^{{}+{}}}(list(0, 0.44))",
                            "lambda%~%{N^{{}+{}}}(list(0, 0.01))",
                            "lambda%~%{N^{{}+{}}}(list(0, 1))",
                            "lambda%~%{N^{{}+{}}}(list(0, 10))",
                            "lambda%~%N(list(0, 0.44))",
                            "lambda%~%N(list(0, 0.01))",
                            "lambda%~%N(list(0, 1))",
                            "lambda%~%N(list(0, 10))")),
    xi = factor(xi,
                levels=c("Base", "Alt_A", "Alt_B", "Alt_C", "Alt_D", "Prior"),
                labels = c("xi=1", "xi=0.1", "xi=10", "xi~Uniform(0.5,1.5)", "xi~Gamma(1,1)", "Prior"),
                ordered=T)
  )

cols=c("xi=1"="#0072b2", "xi=0.5"="#009e73", "xi=10"="#E69F00", "xi~Uniform(0.5,1.5)"="#CC79A7", "xi~Gamma(1,1)"="#d55e00", "Prior"="black") #"#56B4E9", "#E69F00" "#CC79A7", "#d55e00", "#f0e442, "#0072b2"
lty =c("Prior"="dashed", "Post"="solid")
p <- ggplot(plot.dat, aes(x=omega, color=xi, fill=xi, linetype=type))+
  geom_density(adjust=2, alpha=0.1)+
  scale_color_manual(values=cols, name=NULL)+
  scale_fill_manual(values=cols, name=NULL)+
  scale_linetype_manual(values=lty, name=NULL)+
  labs(x="Reliability (omega)")+
  facet_wrap(.~Prior, ncol=4, #scales ="free_y",
             labeller = label_parsed)+
  lims(x=c(0,1),y=c(0,25))+
  theme_classic()+
  theme(
    panel.grid = element_blank(),
    legend.position = "bottom"
  )
p
ggsave(filename = "fig/study4_posterior_sensitity_omega.pdf",plot=p,width = 7.66, height=4.5,units="in")
ggsave(filename = "fig/study4_posterior_sensitity_omega.png",plot=p,width = 7.66, height=4.5,units="in")



# numerically describe due to how close all posteriors were
f <- function(x){
  c(mean(x, na.rm=T), sd(x, na.rm=T), quantile(x, c(0.025, 0.25, 0.5, 0.75, 0.975), na.rm=T))
}

post.sum <- plot.post %>%
  group_by(Prior, xi) %>%
  summarise(
    Mean = mean(omega, na.rm=T),
    SD = sd(omega, na.rm=T),
    q025 = quantile(omega, c(0.025), na.rm=T),
    q25 = quantile(omega, c(0.25), na.rm=T),
    q50 = quantile(omega, c(0.5), na.rm=T),
    q75 = quantile(omega, c(0.75), na.rm=T),
    q975 = quantile(omega, c(0.975), na.rm=T)
  )
kable(post.sum, format="html", digits=3)%>%
  kable_styling(full_width = T)


print(
  xtable(
    post.sum
    , caption = c("Summary of posterior distributions")
  ),
  include.rownames=F,
  booktabs=T
)
```

